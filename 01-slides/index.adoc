= Docker sur le poste du d√©veloppeur
:author: Marc Bouvier
:revealjs_controls: true
:revealjs_progress: true
:revealjs_hash: true
:revealjs_theme: solarized
:revealjs_margin: 0.2

== Docker

"Docker est une plateforme permettant de lancer certaines applications dans des conteneurs logiciels."
-- Wikipedia, https://fr.wikipedia.org/wiki/Docker_(logiciel)[Docker (logiciel)]

=== Docker Compose

"Docker Compose est un logiciel pour d√©finir et ex√©cuter des applications √† partir de multiples conteneurs.
Il est bas√© sur un fichier YAML qui permet de d√©finir les services et les param√®tres de leurs cr√©ations et ainsi de les d√©marrer par une commande unique."
-- Wikipedia, Docker (logiciel) : https://fr.wikipedia.org/wiki/Docker_(logiciel)#Outils_associ.C3.A9s[Outils associ√©s]

=== Docker Hub

Catalogue d'images docker.

https://hub.docker.com/[hub.docker.com]

=== Ouvrir un terminal dans un container

[source,shell]
----
docker run -it --rm alpine
----

Dans Docker Desktop

image::./assets/open-terminal-container.png[width=500]

== Cas d'utilisation 1/2

[.notes]
--
Docker et docker-compose peuvent √™tre utiles au quotidien pour les d√©veloppeurs.
--

* Utiliser des outils sans les installer
* Tester un logiciel compliqu√© √† installer
* Test containers
* Reproduire la CI en local
* Environnements de d√©veloppement conteneuris√©s


=== Cas d'utilisation 2/2

* Lancer des logiciels dont on ne conna√Æt pas la technologie
* Tester une nouvelle version d'un langage
* √ätre admin dans un container
* Infrastructure √©ph√©m√®re
* Bac √† sable
* Simuler l'environnement cible en local

== 01 Utiliser des outils sans les installer

[.notes]
--
* √âviter de polluer son environnement
--

* base de donn√©es
* serveur d'authentification

=== RabbitMq ‚Äî installation classique

Installation classique de RabbitMq

image::./assets/rabbitmq_manual_installation.gif[]

=== RabbitMq ‚Äî lancement avec docker

[source,yml]
----
include::../docker-compose.yml[tag=01-rabbitmq]
----

[source,shell]
----
docker compose up 01-rabbitmq
----

http://localhost:15672

=== Asciidoctor

[.notes]
--
Asciidoctor est un format de markup.
C'est aussi un outil qui permet de g√©n√©rer du contenu.
--

- html
- pdf
- slides
- ebook

=== D√©mo Asciidoctor

Ces slides footnote:[https://github.com/baldir-fr/bbl-docker-pour-le-developpeur]

`docker-compose.yml`

[source,yml]
----
include::../docker-compose.yml[tag=01_slides]
----

[source,shell]
----
docker compose run build-slides
----

== 02 Tester un logiciel compliqu√© √† installer

[.notes]
--
* Par exemple **Gitlab (n√©cessite beaucoup de m√©moire)
** Nextcloud
* Pratique pour jouer avec la configuration
--

=== D√©mo Nextcloud + PostgreSQL

[source,yml]
----
include::../02-tester-logiciel-compliqu√©/nextcloud/docker-compose.yml[]
----

[source,shell]
----
docker compose -f 02-tester-logiciel-compliqu√©/nextcloud/docker-compose.yml up
----

http://localhost:80

== 03 Test Containers

[.notes]
--
* lance un conteneur juste le temps des tests
* bases de donn√©es
* Nginx
* rabbitMq
--

https://www.testcontainers.org/[testcontainers.org]

=== Spring Boot + TestContainers + Redis 1/2

[source,java]
----
include::../03-test-containers/spring-boot/src/test/java/com/example/AbstractIntegrationTest.java[tag=03-test-containers-01]
----

=== Spring Boot + TestContainers + Redis 1/2

[source,java]
----
include::../03-test-containers/spring-boot/src/test/java/com/example/DemoControllerTest.java[tag=03-test-containers-02]
----

=== D√©mo

[source,shell]
----
cd 03-test-containers/spring-boot/
./gradlew build
----

https://github.com/baldir-fr/bbl-docker-pour-le-developpeur/tree/main/03-test-containers/spring-boot

== 04 Reproduire la CI en local

[.notes]
--
Lancer des scripts sur le m√™me environnement que la CI
--

== 05 Environnements de d√©veloppement conteneuris√©s

[.notes]
--
* Vs code remote
* Gitpod
* Code Server
--

=== Code Server

https://github.com/coder/code-server

Editeur de code pr√©-configur√© sur le navigateur.

=== D√©mo

[source,yml]
----
include::../docker-compose.yml[tag=05-code-server]
----

[source,shell]
----
docker compose up -d 05-code-server
----

http://localhost:8094

== 06 Lancer des logiciels dont on ne conna√Æt pas la technologie

[.notes]
--
* Par exemple springboot si on fait du JavaScript
* Keycloak
* ffmpeg + imagemagick
--

https://github.com/docker/awesome-compose[Awesome Docker Compose] starters

=== Conversion de .mov en .gif

https://toub.es/2017/09/11/high-quality-gif-with-ffmpeg-and-docker/

[source,shell]
----
alias video2gif='sudo docker run -v=`pwd`:/tmp/ffmpeg kafebob/video2gif'
----

[source,shell]
----
video2gif rabbitmq_manual_installation.mov rabbitmq_manual_installation.gif
----

== 07 Tester une nouvelle version d'un langage

[.notes]
--
* (ex. java 11 java 17..)
--

=== Java 8

[source,yml]
----
include::../docker-compose.yml[tag=07_java_8]
----

[source,shell]
----
docker compose run 07-movie-rental-java-8
----



=== Java 17

[source,yml]
----
include::../docker-compose.yml[tag=07_java_17]
----


[source,shell]
----
docker compose run 07-movie-rental-java-17
----


== 08 √ätre admin dans un conteneur

[.notes]
--
* quand on n'est pas admin de sa machine sur Windows par exemple
--

* installer des paquets sur une image

== 09 Infrastructure √©ph√©m√®re

[.notes]
--
Lancer un serveur pour le temps d'un √©v√©nement * Pour un √©v√©nement donn√©, lancer un serveur * Le supprimer √† la fin de l'√©v√©nement * Permet aux participants d'acc√©der √† l'outil sans s'inscrire par exemple (les donn√©es sont supprim√©es √† la fin de l'√©v√©nement)
--

=== Tiddlywiki

[source,yml]
----
include::../docker-compose.yml[tag=09_tiddlywiki]
----

[source,shell]
----
docker compose up -d 09-tiddlywiki
----

http://localhost:8082

== 10 Bac √† sable

[.notes]
--
* Exp√©rimenter sans risques
* Essayer des choses risqu√©es dans un environnement safe
* apprendre les commandes linux sans tout casser
** sous r√©serve de certaines pr√©cautions
--

=== Apprendre les commandes linux

https://hub.docker.com/_/busybox[Busybox] : https://en.wikipedia.org/wiki/BusyBox#Commands[Commandes disponibles]

[source,shell]
----
docker run -it --rm busybox
----

https://hub.docker.com/_/alpine[Alpine]

[source,shell]
----
docker run -it --rm alpine
----

== 11 Simuler l'environnement cible en local

[.notes]
--
* ex depuis windows ex√©cuter sur linux
--

=== Keycloak + Vuejs + Spring-boot 1/2

[source,yml]
----
include::../11-simuler-environnement-cible/docker-for-local-development-bbl-main/docker-compose.yml[]
----

[source,shell]
----
docker compose -f 11-simuler-environnement-cible/docker-for-local-development-bbl-main/docker-compose.yml up -d
----

http://kubernetes.docker.internal:8080

http://kubernetes.docker.internal:5173

=== Keycloak + Vuejs + Spring-boot 2/2

image::assets/11-docker-compose.png[]

[source,shell]
----
docker run --rm -it --name dcv -v $(pwd):/input pmsipilot/docker-compose-viz render -m image -f docker-compose.yml
----

== üôè Merci

Des questions?
üñê